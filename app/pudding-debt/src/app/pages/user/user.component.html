<div class="add-button">
	<button mat-raised-button color="primary" (click)="openDialog()">
		Add participant to event
	</button>
</div>

<mat-accordion class="user-list">
	<mat-expansion-panel
		*ngFor="let userWithBalance of usersWithBalance"
		(opened)="getExpenses(userWithBalance.user)"
	>
		<mat-expansion-panel-header>
			<mat-panel-title>{{ userWithBalance.user.name }} - Spending: {{ userWithBalance.balances.spending }} - Expenses: {{ userWithBalance.balances.expenses }} - Balance: {{ userWithBalance.balances.balance }}</mat-panel-title>
		</mat-expansion-panel-header>
		<ng-template matExpansionPanelContent>
			<!-- Deferred initialization until the panel is open. -->
			<div class="spinner-container" *ngIf="dataSource.loading$ | async">
				<mat-spinner></mat-spinner>
			</div>
			<table mat-table class="expense-table" [dataSource]="dataSource">
				<!-- Name Column -->
				<ng-container matColumnDef="name">
					<th mat-header-cell *matHeaderCellDef>Name</th>
					<td mat-cell *matCellDef="let expense">
						{{ expense.name }}
					</td>
				</ng-container>

				<!-- Amount Column -->
				<ng-container matColumnDef="amount">
					<th mat-header-cell *matHeaderCellDef>Amount</th>
					<td mat-cell *matCellDef="let expense">
						{{ expense.amount | currency:'':'':'1.2-2':'no' }} kr
					</td></ng-container
				>

				<!-- Category Column -->
				<ng-container matColumnDef="category">
					<th mat-header-cell *matHeaderCellDef>Category</th>
					<td mat-cell *matCellDef="let expense">
						{{ expense.categoryName }}
					</td></ng-container
				>

				<!-- Description Column -->
				<ng-container matColumnDef="description">
					<th mat-header-cell *matHeaderCellDef>Description</th>
					<td mat-cell *matCellDef="let expense">
						{{ expense.description }}
					</td>
				</ng-container>

				<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
				<tr
					mat-row
					*matRowDef="let row; columns: displayedColumns"
				></tr>
				<tr class="mat-row" *matNoDataRow>
					<td
						class="mat-cell"
						[attr.colspan]="displayedColumns.length"
					>
						No expenses found
					</td>
				</tr>
			</table>
		</ng-template>
	</mat-expansion-panel>
</mat-accordion>

<ng-template #emptyMessage><p>Participant has no expenses</p></ng-template>
