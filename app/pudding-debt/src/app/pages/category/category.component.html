<div class="add-button" >
    <button mat-raised-button color="primary" (click)="openDialog()">Add category</button>
</div>

<mat-accordion class="categories">
    <div cdkDropList (cdkDropListDropped)="drop($event)">
	<mat-expansion-panel *ngFor="let category of categories" cdkDrag>
		<mat-expansion-panel-header>
			<mat-panel-title>{{ category.name }}</mat-panel-title>
		</mat-expansion-panel-header>

		<table mat-table class="category-table" [dataSource]="category.users">
			<!-- Name Column -->
			<ng-container matColumnDef="name">
				<th mat-header-cell *matHeaderCellDef>Participant</th>
				<td mat-cell *matCellDef="let user">{{ user.name }}</td>
				<td mat-footer-cell *matFooterCellDef>
					<mat-form-field class="category-user-name">
						<select matNativeControl [formControl]="name" required>
                            <option value="" disabled selected>Choose participant</option>
							<option
								*ngFor="let user of filterUsers(category.id)"
								[value]="user.id"
							>
								{{ user.name }}
							</option>
						</select>
					</mat-form-field>
				</td>
			</ng-container>

			<!-- Weight Column -->
			<ng-container matColumnDef="weight">
				<th mat-header-cell *matHeaderCellDef>Weight</th>
				<td mat-cell *matCellDef="let user">{{ user.weight }}</td>
				<td mat-footer-cell *matFooterCellDef>
					<mat-form-field>
						<input matInput [formControl]="weight" placeholder="Weight" />
					</mat-form-field>
				</td>
			</ng-container>

            <!-- Save button column -->
            <ng-container matColumnDef="save">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let user">
                    <button mat-icon-button type="button" (click)="removeUser(category.id, user.id)">
                        <mat-icon>delete</mat-icon>
                    </button>
                </td>
                <td mat-footer-cell *matFooterCellDef>
                    <button mat-icon-button type="button" (click)="addUser(category.id)">
                        <mat-icon>add_circle</mat-icon>
                    </button>
                </td>
            </ng-container>

			<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
			<tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

			<tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
		</table>
	</mat-expansion-panel>
</div>
</mat-accordion>

