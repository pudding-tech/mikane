# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

orbs:
  browser-tools: circleci/browser-tools@1.1.0

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
jobs:
    frontend-build:
        working_directory: ~/project/app/pudding-debt
        docker:
            - image: cimg/node:16.20.1-browsers
        steps:
            - browser-tools/install-browser-tools
            - run: |
                node --version
                google-chrome --version
            - checkout:
                  path: ~/project
            - restore_cache:
                  key: pudding-debt-{{ .Branch }}-{{ checksum "package.json" }}
            - run: npm install
            - save_cache:
                  key: pudding-debt-{{ .Branch }}-{{ checksum "package.json" }}
                  paths:
                      - "node_modules"
            - run: xvfb-run -a npm run build
            - run: xvfb-run -a npm run test

# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
    build-workflow:
        jobs:
            - frontend-build
